CREACION TABLAS TIPO B


CREATE TABLE CLIENTE (
    ID_CLIENTE NUMBER,
    DNI CHAR(9),
    NOMBRE VARCHAR2(40),
    TELEFONO NUMBER(9),
    DIRECCION VARCHAR2(100),
    CONSTRAINT pk_cliente PRIMARY KEY (ID_CLIENTE),
    CONSTRAINT unq_cliente_dni UNIQUE (DNI),
    CONSTRAINT nn_cliente_dni CHECK (DNI IS NOT NULL),
    CONSTRAINT nn_cliente_nombre CHECK (NOMBRE IS NOT NULL),
    CONSTRAINT nn_cliente_telefono CHECK (TELEFONO IS NOT NULL) 
);


CREATE TABLE VEHICULO (
    ID_VEHICULO NUMBER,
    MATRICULA VARCHAR2(10),
    MARCA VARCHAR2(20),
    MODELO VARCHAR2(30),
    ANIO NUMBER(4),
    CONSTRAINT pk_vehiculo PRIMARY KEY (ID_VEHICULO),
    CONSTRAINT unq_vehiculo_matricula UNIQUE (MATRICULA),
    CONSTRAINT nn_vehiculo_matricula CHECK (MATRICULA IS NOT NULL),
    CONSTRAINT nn_vehiculo_marca CHECK (MARCA IS NOT NULL),
    CONSTRAINT nn_vehiculo_modelo CHECK (MODELO IS NOT NULL),
    CONSTRAINT nn_vehiculo_anio CHECK (ANIO IS NOT NULL)
);


CREATE TABLE SERVICIO (
    ID_SERVICIO NUMBER,
    DESCRIPCION VARCHAR2(100),
    COSTE NUMBER(10,2),
    CONSTRAINT pk_servicio PRIMARY KEY (ID_SERVICIO),
    CONSTRAINT nn_servicio_descripcion CHECK (DESCRIPCION IS NOT NULL),
    CONSTRAINT chk_servicio_coste CHECK (COSTE >= 0),
    CONSTRAINT nn_servicio_coste CHECK (COSTE IS NOT NULL)
);


CREATE TABLE PAGOS (
    ID_PAGO NUMBER,
    FECHA DATE DEFAULT SYSDATE,
    TOTAL NUMBER(10,2),
    TIPO_PAGO VARCHAR2(20),
    ID_SERVICIO NUMBER,
    CONSTRAINT pk_pago PRIMARY KEY (ID_PAGO),
    CONSTRAINT fk_pago_servicio FOREIGN KEY (ID_SERVICIO) REFERENCES SERVICIO(ID_SERVICIO),
    CONSTRAINT nn_pago_tipo CHECK (TIPO_PAGO IS NOT NULL),
    CONSTRAINT chk_pago_total CHECK (TOTAL >= 0),
    CONSTRAINT nn_pago_total CHECK (TOTAL IS NOT NULL)
);


CREATE TABLE CLIENTE_VEHICULO (
    ID_CLIENTE NUMBER,
    ID_VEHICULO NUMBER,
    FECHA_COMPRA DATE,
    FECHA_VENTA DATE,
    CONSTRAINT pk_cliente_vehiculo PRIMARY KEY (ID_CLIENTE, ID_VEHICULO),
    CONSTRAINT fk_cliente_vehiculo_cliente FOREIGN KEY (ID_CLIENTE) REFERENCES CLIENTE(ID_CLIENTE),
    CONSTRAINT fk_cliente_vehiculo_vehiculo FOREIGN KEY (ID_VEHICULO) REFERENCES VEHICULO(ID_VEHICULO),
    CONSTRAINT nn_fecha_compra CHECK (FECHA_COMPRA IS NOT NULL)
);


CREATE TABLE VEHICULO_SERVICIO (
    ID_VEHICULO_SERVICIO NUMBER,
    ID_VEHICULO NUMBER,
    ID_SERVICIO NUMBER,
    FECHA DATE DEFAULT SYSDATE,
    CONSTRAINT pk_vehiculo_servicio PRIMARY KEY (ID_VEHICULO_SERVICIO),
    CONSTRAINT fk_vehiculo_servicio_vehiculo FOREIGN KEY (ID_VEHICULO) REFERENCES VEHICULO(ID_VEHICULO),
    CONSTRAINT fk_vehiculo_servicio_servicio FOREIGN KEY (ID_SERVICIO) REFERENCES SERVICIO(ID_SERVICIO)
);


INSERTS:

INSERT INTO CLIENTE (ID_CLIENTE, DNI, NOMBRE, TELEFONO, DIRECCION)
VALUES (1, '12345678A', 'Juan Perez', 600111222, 'Calle A, 1');

INSERT INTO CLIENTE (ID_CLIENTE, DNI, NOMBRE, TELEFONO, DIRECCION)
VALUES (2, '87654321B', 'Maria Lopez', 600333444, 'Calle B, 2');

INSERT INTO CLIENTE (ID_CLIENTE, DNI, NOMBRE, TELEFONO, DIRECCION)
VALUES (3, '11223344C', 'Carlos Ruiz', 600555666, 'Calle C, 3');

INSERT INTO CLIENTE (ID_CLIENTE, DNI, NOMBRE, TELEFONO, DIRECCION)
VALUES (4, '44332211D', 'Ana Garcia', 600777888, 'Calle D, 4');




INSERT INTO VEHICULO (ID_VEHICULO, MATRICULA, MARCA, MODELO, ANIO)
VALUES (1, '1111AAA', 'Toyota', 'Corolla', 2020);

INSERT INTO VEHICULO (ID_VEHICULO, MATRICULA, MARCA, MODELO, ANIO)
VALUES (2, '2222BBB', 'Ford', 'Focus', 2019);

INSERT INTO VEHICULO (ID_VEHICULO, MATRICULA, MARCA, MODELO, ANIO)
VALUES (3, '3333CCC', 'Honda', 'Civic', 2021);

INSERT INTO VEHICULO (ID_VEHICULO, MATRICULA, MARCA, MODELO, ANIO)
VALUES (4, '4444DDD', 'BMW', 'X5', 2018);




INSERT INTO SERVICIO (ID_SERVICIO, DESCRIPCION, COSTE)
VALUES (1, 'MANTENIMIENTO', 200.00);

INSERT INTO SERVICIO (ID_SERVICIO, DESCRIPCION, COSTE)
VALUES (2, 'MANTENIMIENTO', 100.00);

INSERT INTO SERVICIO (ID_SERVICIO, DESCRIPCION, COSTE)
VALUES (3, 'REPARACION', 180.00);    

INSERT INTO SERVICIO (ID_SERVICIO, DESCRIPCION, COSTE)
VALUES (4, 'MANTENIMIENTO', 160.00);  




-- Pagos para servicios de mantenimiento/reparación
INSERT INTO PAGOS (ID_PAGO, FECHA, TOTAL, TIPO_PAGO, ID_SERVICIO)
VALUES (1, SYSDATE - 5, 200.00, 'Contado', 1);   -- Mantenimiento que califica

INSERT INTO PAGOS (ID_PAGO, FECHA, TOTAL, TIPO_PAGO, ID_SERVICIO)
VALUES (2, SYSDATE - 10, 160.00, 'Financiado', 4); -- Mantenimiento que califica

INSERT INTO PAGOS (ID_PAGO, FECHA, TOTAL, TIPO_PAGO, ID_SERVICIO)
VALUES (3, SYSDATE - 15, 100.00, 'Contado', 2);   -- Mantenimiento que NO califica

INSERT INTO PAGOS (ID_PAGO, FECHA, TOTAL, TIPO_PAGO, ID_SERVICIO)
VALUES (4, SYSDATE - 20, 180.00, 'Tarjeta', 3);     -- Reparación

-- Pagos para la compra de vehículos
INSERT INTO PAGOS (ID_PAGO, FECHA, TOTAL, TIPO_PAGO, ID_SERVICIO)
VALUES (5, SYSDATE - 5, 15000.00, 'Contado', 5);    -- Compra reciente

INSERT INTO PAGOS (ID_PAGO, FECHA, TOTAL, TIPO_PAGO, ID_SERVICIO)
VALUES (6, SYSDATE - 40, 15000.00, 'Financiado', 5); -- Compra hace más de 30 días





-- Vehículo 1: Comprado por el cliente 1 y aún en posesión (no vendido)
INSERT INTO CLIENTE_VEHICULO (ID_CLIENTE, ID_VEHICULO, FECHA_COMPRA, FECHA_VENTA)
VALUES (1, 1, SYSDATE - 10, NULL);

-- Vehículo 2: Comprado por el cliente 1 y vendido; se registra la venta en la misma fila
INSERT INTO CLIENTE_VEHICULO (ID_CLIENTE, ID_VEHICULO, FECHA_COMPRA, FECHA_VENTA)
VALUES (1, 2, SYSDATE - 20, SYSDATE - 15);

-- Vehículo 2: Para el nuevo propietario, el cliente 2, se registra la compra (sin fecha de venta aún)
INSERT INTO CLIENTE_VEHICULO (ID_CLIENTE, ID_VEHICULO, FECHA_COMPRA, FECHA_VENTA)
VALUES (2, 2, SYSDATE - 14, NULL);

-- Vehículo 3: Comprado por el cliente 3, sin venta
INSERT INTO CLIENTE_VEHICULO (ID_CLIENTE, ID_VEHICULO, FECHA_COMPRA, FECHA_VENTA)
VALUES (3, 3, SYSDATE - 8, NULL);

-- Vehículo 4: Comprado por el cliente 4, sin venta
INSERT INTO CLIENTE_VEHICULO (ID_CLIENTE, ID_VEHICULO, FECHA_COMPRA, FECHA_VENTA)
VALUES (4, 4, SYSDATE - 7, NULL);





-- Vehículo 1: Servicio de mantenimiento que califica (servicio 1: coste 200)
INSERT INTO VEHICULO_SERVICIO (ID_VEHICULO_SERVICIO, ID_VEHICULO, ID_SERVICIO, FECHA)
VALUES (1, 1, 1, SYSDATE);

-- Vehículo 2: Servicio de mantenimiento que NO califica (servicio 2: coste 100)
INSERT INTO VEHICULO_SERVICIO (ID_VEHICULO_SERVICIO, ID_VEHICULO, ID_SERVICIO, FECHA)
VALUES (2, 2, 2, SYSDATE);

-- Vehículo 3: Servicio de mantenimiento que califica (servicio 4: coste 160)
INSERT INTO VEHICULO_SERVICIO (ID_VEHICULO_SERVICIO, ID_VEHICULO, ID_SERVICIO, FECHA)
VALUES (3, 3, 4, SYSDATE);

-- Vehículo 4: Servicio de reparación (no es mantenimiento)
INSERT INTO VEHICULO_SERVICIO (ID_VEHICULO_SERVICIO, ID_VEHICULO, ID_SERVICIO, FECHA)
VALUES (4, 4, 3, SYSDATE);

-- Vehículo 2: Otro servicio de mantenimiento que califica (usamos servicio 1: coste 200)
INSERT INTO VEHICULO_SERVICIO (ID_VEHICULO_SERVICIO, ID_VEHICULO, ID_SERVICIO, FECHA)
VALUES (5, 2, 1, SYSDATE);






1. Servicios que tenemos de descripción “MANTENIMIENTO” con más de 150 Euros de coste.

SELECT * FROM SERVICIO
WHERE DESCRIPCION = 'MANTENIMIENTO'
AND COSTE > 150;

SELECT ID_SERVICIO, DESCRIPCION, COSTE
FROM SERVICIO
WHERE DESCRIPCION = 'MANTENIMIENTO'
AND COSTE > 150;


2. Tipo de pago de TODOS los Servicios que tenemos de descripción “MANTENIMIENTO” con más de 150 Euros de coste.

SELECT TIPO_PAGO FROM PAGOS, SERVICIO
WHERE SERVICIO.ID_SERVICIO = PAGOS.ID_SERVICIO
AND SERVICIO.DESCRIPCION = 'MANTENIMIENTO'
AND SERVICIO.COSTE > 150;

3. Matrícula de vehículos que hayan sido comprados por clientes pero todavía NO vendidos por ellos.

SELECT VEHICULO.MATRICULA, CLIENTE_VEHICULO.FECHA_COMPRA
FROM VEHICULO, CLIENTE_VEHICULO
WHERE VEHICULO.ID_VEHICULO = CLIENTE_VEHICULO.ID_VEHICULO
AND CLIENTE_VEHICULO.FECHA_VENTA IS NULL;


4. DNI y teléfono de los clientes que hayan comprado algún coche en los últimos 30 días.

SELECT CLIENTE.DNI, CLIENTE.TELEFONO
FROM CLIENTE_VEHICULO, CLIENTE
WHERE CLIENTE.ID_CLIENTE = CLIENTE_VEHICULO.ID_CLIENTE
AND CLIENTE_VEHICULO.FECHA_COMPRA >= SYSDATE - 30;

5. Número total de coches que hayan tenido algún servicio de “MANTENIMIENTO” con más de 150 Euros de coste.

SELECT COUNT(DISTINCT VEHICULO_SERVICIO.ID_VEHICULO) AS SERV_COCHES_150
FROM VEHICULO_SERVICIO, SERVICIO
WHERE VEHICULO_SERVICIO.ID_SERVICIO = SERVICIO.ID_SERVICIO
AND SERVICIO.DESCRIPCION = 'MANTENIMIENTO'
AND SERVICIO.COSTE > 150;






